# Project Restructuring Implementation Plan

This plan outlines the steps to restructure the service catalog, update the User App booking flow, and implement the new Vendor Billing and Wallet logic as per the user's request.

## User Review Required

> [!IMPORTANT]
> - **Renaming Services to Brands**: This is a core architectural change. We will rename the existing [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182) model/APIs to `Brand` and introduce a new, leaner [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182) model.
> - **Database Migration**: A migration script will be needed to move existing [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182) data to the new `Brand` model and potentially re-link existing bookings.
> - **UI Structure**: The Admin sidebar and User App flow will be significantly altered.

## Proposed Changes

### Database & Models

#### [MODIFY] [Brand.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/models/Brand.js) (Previously [Service.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/models/Service.js))
- Rename [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182) model to `Brand`.
- Update field names and references if necessary.

#### [NEW] [Service.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/models/Service.js)
- Fields: `brandId` (FK), `name`, `iconUrl`, `basePrice`, `gstPercentage`, `status`.

#### [NEW] [VendorServiceCatalog.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/models/VendorServiceCatalog.js)
- Fields: `name`, `price`, `status`.

#### [NEW] [VendorPartsCatalog.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/models/VendorPartsCatalog.js)
- Fields: `name`, `price`, `gstApplicable` (boolean), `gstPercentage`, `status`.

---

### Backend Development

#### [MODIFY] Catalog Controllers
- Refactor [adminControllers/serviceController.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/controllers/adminControllers/serviceController.js) to handle `Brands`.
- Create new controllers for the new [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182) model.
- Update routes in [admin-routes/serviceManagement.routes.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/routes/admin-routes/serviceManagement.routes.js).

#### [MODIFY] Booking Controllers
- Update [userBookingController.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/controllers/bookingControllers/userBookingController.js) to calculate total as `basePrice + (basePrice * gstPercentage / 100)`.
- Implement `vendorBillController.js` to handle final billing after job completion.

#### [MODIFY] Wallet Logic
- Update [vendorWalletController.js](file:///c:/Users/SHUBHAM/Desktop/Homster/Backend/controllers/vendorControllers/vendorWalletController.js) to calculate commission based on (Price - GST).

---

### Frontend Development

#### [MODIFY] Admin Panel
- Update sidebar to rename "Services" to "Brands".
- Add new sidebar items for "Vendor Service Catalog" and "Vendor Parts Catalog".
- Implement CRUD UIs for new catalogs and the new "Services" layer under Brands.

#### [MODIFY] User App
- Update category click handler to open a bottom modal.
- Implement Brand selection list in the modal.
- Implement Service list (filtered by Brand) on selection.
- Update checkout page with new GST and total calculation logic.

#### [MODIFY] Vendor App
- Add a "Create Bill" screen triggered after job completion.
- Implement searchable selection for Vendor Services and Parts.
- Add "Custom Item" input.
- Show auto-calculated GST and Final Bill.

---

## Verification Plan

### Automated Tests
- Run existing model tests: `node Backend/tests/testModels.js`
- Create new model tests for `Brand`, [Service](file:///c:/Users/SHUBHAM/Desktop/Homster/Frontend/src/services/catalogService.js#164-182), `VendorServiceCatalog`, etc.

### Manual Verification
1. **Admin Catalog**: Create a Brand under a Category, then a Service under that Brand. Verify visibility in Admin UI.
2. **User Flow**: Open User App, select Category -> select Brand (Modal) -> select Service -> Proceed to Book. Verify price calculation.
3. **Vendor Billing**: Login as Vendor, complete a job, add items from Catalog and custom items. Verify Final Bill value.
4. **Wallet Verification**: Verify vendor earnings in wallet do not include GST amounts.
